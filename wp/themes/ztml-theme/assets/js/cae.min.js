(()=>{"use strict";jQuery(document).ready(function(u){var a=u(".cae .cards-list");const p=a=>{var e=Math.floor(a/60),a=parseInt(a-60*e);return{minutes:e<10?"0"+e:e,seconds:a<10?"0"+a:a}},m=[];function y(a){var e=a.min,t=a.max,n=a.value;a.style.backgroundSize=100*(n-e)/(t-e)+"% 100%"}u(".cae .cards-list .mn-player").each(function(a,e){u(e).find("input[type='range']").each(function(a,e){y(e)});const t=u(e).find("audio")[0],n=u(e).find("#time")[0];t.addEventListener("canplaythrough",()=>{var a=p(t.duration);n.textContent=`00:00 — ${a.minutes||"00"}:`+(a.seconds||"00")},{once:!0})});const f="PLAY_TYPE_EVENT",_="VOLUME_TYPE_EVENT",v="TRACK_TYPE_EVENT";a.click(a=>{var a=u(a.target),e=(a.closest(".card-item__footer").length&&((e=a.closest(".card-item").find(".card-item__description")).hasClass("nowrap")?e.removeClass("nowrap"):e.addClass("nowrap")),a.closest(".mn-player"));if(e.length){t=e[0];let s=m.find(a=>t===a.el);s||(r=e.find(".player-controls__play-btn"),n=e.find(".player-controls__volume input[type='range']"),c=e.find(".mn-player__track-bar input[type='range']"),l=e.find("#time"),o=e.find("audio"),s=(e={el:e[0],audio:o[0],time:c[0],timer:l[0],playBtn:r[0],trackBar:c[0],volume:n[0],audioTrackInterval:null,isPlay:!1},m.push(e),e)),y(s.volume),y(s.trackBar),l=u((o=a).closest(".player-controls__play-btn")[0]).hasClass("player-controls__play-btn"),r=u(o.closest(".player-controls__volume")[0]).hasClass("player-controls__volume"),o=u(o.closest(".mn-player__track-bar")[0]).hasClass("mn-player__track-bar");var t,n,o,l,r,i,c=l?f:r?_:o?v:"INIT_TYPE_EVENT";if(c==f){if(i=s,m.forEach(a=>{a.el!=i.el&&(u(a.el).find(".cae_play_icon").css("display","inline-block"),u(a.el).find(".cae_pause_icon").css("display","none"),a.isPlay=!1,a.audio.pause(),clearInterval(a.audioTrackInterval))}),s.isPlay=!s.isPlay,s.isPlay){const d=p(s.audio.duration);s.audio.play(),u(s.playBtn).find(".cae_play_icon").css("display","none"),u(s.playBtn).find(".cae_pause_icon").css("display","inline-block"),s.audioTrackInterval=setInterval(()=>{var a=s,e=d,t=s.audioTrackInterval,{audio:a,trackBar:n,timer:o}=a,l=p(a.currentTime);a.currentTime>=a.duration?(clearInterval(t),a.currentTime=0,a.pause()):(n.value=Math.floor(a.currentTime/a.duration*100),o.textContent=`${l.minutes}:${l.seconds} - ${e.minutes||"00"}:`+(e.seconds||"00")),y(n),y(a)},1e3)}s.isPlay||(s.audio.pause(),u(s.playBtn).find(".cae_play_icon").css("display","inline-block"),u(s.playBtn).find(".cae_pause_icon").css("display","none"),clearInterval(s.audioTrackInterval))}c==_&&(s.audio.volume=s.volume.value/100,y(s.volume)),c==v&&(s.audio.play(),s.audio.currentTime=s.trackBar.value*s.audio.duration/100,s.audio.pause(),y(s.trackBar))}})}),jQuery(document).ready(function(t){const n=t(".load-moree-btn"),e=(a,e)=>t.ajax({url:"/wp-admin/admin-ajax.php",data:{...s,...a},type:"POST",success:a=>e(a)}),o=(t.datepicker.setDefaults(t.datepicker.regional.ru),t(".datepicker-toggle .datepicker-reset-button"));let l=null;const s={action:"taxonomy_cae_load",load:27,offset:27,post_type:"cae"};o.on("click",()=>{l=null,s.offset=0,e({date:null},a=>{var e;o.hide(),a&&({posts:a,count:e}=JSON.parse(a),e<=s.offset+s.load?n.hide():n.show(),t(".main-content .cards-list").empty(),t(".main-content .cards-list").append(a),s.offset+=s.load,t(".load-moree-btn button").attr("data-all-posts",e))})}),n.on("click",()=>{n.find("button").text("Загрузка..."),e(l?{date:l}:{},a=>{var e;a&&({posts:a,count:e}=JSON.parse(a),e<=s.offset+s.load?n.hide():n.show(),t(".main-content .cards-list").append(a),s.offset+=s.load,t(".load-moree-btn button").attr("data-all-posts",e),n.find("button").text("Показать еще"))})}),t("#datepicker-take-actions-template").datepicker({showOn:"both",changeYear:!0,changeMonth:!0,dateFormat:"yy-mm-dd",minDate:t("#datepicker-take-actions-template").data("min-date"),maxDate:t("#datepicker-take-actions-template").data("max-date"),onSelect:a=>{l=a,s.offset=0,e({date:a},a=>{var{posts:a,count:e}=JSON.parse(a);o.show(),e<=s.offset+s.load?t(".load-moree-btn").hide():t(".load-moree-btn").show(),t(".main-content .cards-list").empty(),t(".main-content .cards-list").append(a),s.offset+=s.load,t(".load-moree-btn button").attr("data-all-posts",e)})}})})})();